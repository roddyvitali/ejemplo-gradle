pipeline {
	agent any
	stages {
	    stage('downloadNexus') {
			steps {
				sh 'curl -X GET -u admin:123456 http://1f84c9788a2a.ngrok.io/repository/test-nexus/com/devopsusach2020/DevOpsUsach2020/0.0.1/DevOpsUsach2020-0.0.1.jar -O'
				sh 'ls -ltr'
			}
		}
	    stage('run') {
			steps {
				sh 'nohup java -Dserver.port=8888 -jar ./DevOpsUsach2020-0.0.1.jar &'
			}
		}
		stage('test') {
			steps {
                sh 'sleep 20'
				sh 'curl -X GET http://localhost:8888/rest/mscovid/test?msg=testing'
			}
		}
		stage('uploadNexus') {
			steps {
				nexusPublisher nexusInstanceId: 'nexus', nexusRepositoryId: 'test-nexus', packages: [[$class: 'MavenPackage', mavenAssetList: [[classifier: '', extension: 'jar', filePath: './DevOpsUsach2020-0.0.1.jar']], mavenCoordinate: [artifactId: 'DevOpsUsach2020', groupId: 'com.devopsusach2020', packaging: 'jar', version: '1.0.0']]]
			}
		}
	}
}